{
    "contents" : "\nrequire(shiny)\nrequire(shinydashboard)\nrequire(rCharts)\nrequire(reshape2)\nrequire(lubridate)\nrequire(caTools)\nrequire(DT)\n\nshinyServer(function(input, output,session) {\n  \n  makeReactiveBinding(\"team\")\n  makeReactiveBinding(\"datas_bet\")\n  makeReactiveBinding(\"datas.shoot.away\")\n  team <<- list(\"First\",\"Two\")\n  \n  repertoire <- tempdir()\n  \n  \n  #Recupere les donnees\n  observe({\n      if(input$download_datas>0)\n      {\n      datas_to_dl <- list(ligue1=c('http://www.football-data.co.uk/mmz4281/1516/F1.csv',paste(repertoire,'/F1.csv',sep=\"\")),\n                          all.leagues=c('http://football-data.co.uk/mmz4281/1516/data.zip',paste(repertoire,'/data.zip',sep=\"\")))\n      \n      lapply(X = datas_to_dl,FUN = function(x) utils::download.file(url = x[1],destfile=x[2]))\n      unzip (file.path(repertoire,\"data.zip\"),exdir = repertoire)\n      }\n   })\n  \n  # Selection league\n  observe({\n   \n    if(input$download_datas>0)\n    {\n      datas_bet <- read.csv(file.path(repertoire,paste(input$league,'.csv',sep=\"\")))\n      datas_bet$Date <- as.Date(as.character(datas_bet$Date),\"%d/%m/%Y\")\n      year(datas_bet$Date) <- year(datas_bet$Date) +2000\n      datas_bet <<- data.frame(datas_bet)\n      team <- levels(factor(datas_bet$HomeTeam))\n      list.team <- list()\n      \n      for (i in 1:length(team))\n      {\n        list.team[i] <- list(team[i])\n      }\n      \n      team<<-list.team\n    }\n  })\n  \n  \n  output$selectHome <- renderUI({ \n    if(length(team)>0)\n    {\n      selectInput(\"home_team\", label = h3(\"Home Team\"), \n                      choices = team,\n                      selected = 1)\n        } # end du if download\n  }) #en du render UI\n  \n  output$selectAway <- renderUI({ \n    if(length(team)>0)\n    {\n      selectInput(\"away_team\", label = h3(\"Away Team\"), \n                  choices = team,\n                  selected = 3)\n    } # end du if download\n  }) #en du render UI\n  \n  #### Graphique nombres de buts a domicile\n  output$graph_but_home_match <- renderChart2({  \n    \n    h_buts <- Highcharts$new()\n    \n    if(length(team)>0)\n    {\n      #selction de l equipe\n      i=which(input$home_team==team)\n      datas.home <- dplyr::filter(datas_bet,HomeTeam==team[i])\n      \n      ##### Nombre de buts      \n      #transfo dates pour hplot\n      datas.home=data.frame(Date=datas.home$Date,\n                            total_goals=datas.home$FTHG+datas.home$FTAG ,\n                            goals_first_half=datas.home$HTHG+datas.home$HTAG,\n                            goals_second_half=(datas.home$FTHG+datas.home$FTAG)-(datas.home$HTHG+datas.home$HTAG)\n      )\n      \n      datas.home$Date=as.numeric(as.POSIXct(datas.home$Date))*1000\n      \n      datas.home.melt=melt(datas.home,value.name = 'value',id.vars = c('Date'))\n      \n      # Graphiques\n      h_buts <- rCharts::hPlot(data = datas.home.melt,\n                               x=\"Date\",y=\"value\",group=\"variable\",\n                               type=\"column\",\n                               title =paste(\"Nbre de buts par matchs a domicile: \",input$home_team,sep=\"\"))\n      \n      h_buts$xAxis(type = \"datetime\")\n      h_buts$chart(height=450,zoomType = \"xy\",width=600)\n      h_buts$exporting(enabled = T)\n      h_buts$params$yAxis[1]=list(list(title = list(text = 'Nbre de buts par matchs a domicile')))\n      h_buts$colors('#99CC99', '#f4b541', '#4587DE')\n      #   green, yellow, blue\n      \n      # Moyenne mobile\n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$total_goals,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals total\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#4587DE\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n      )\n      \n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_first_half,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals first half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#99CC99\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_second_half,input$moy_mob)), json = F, names = F),\n        name =  paste(\"Mean goals second half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#f4b541\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n            h_buts$series(\n              data = toJSONArray2(data.frame(datas.home$Date,2.5), json = F, names = F),\n              type = \"spline\",\n              color=\"black\",\n              enableMouseTracking=F,\n              marker=list(enabled=F),\n              lineWidth=2\n              #yAxis=1\n            )\n      \n      h_buts\n      \n    }\n    \n  })\n  \n  \n  #### Graphique nombres de buts away match\n  output$graph_but_away_match <- renderChart2({  \n    \n    h_buts <- Highcharts$new()\n    \n    if(length(team)>0)\n    {\n      #selction de l equipe\n      i=which(input$away_team==team)\n      datas.home <- dplyr::filter(datas_bet,AwayTeam==team[i])\n      \n      ##### Nombre de buts      \n      #transfo dates pour hplot\n      datas.home=data.frame(Date=datas.home$Date,\n                            total_goals=datas.home$FTHG+datas.home$FTAG ,\n                            goals_first_half=datas.home$HTHG+datas.home$HTAG,\n                            goals_second_half=(datas.home$FTHG+datas.home$FTAG)-(datas.home$HTHG+datas.home$HTAG)\n      )\n      \n      datas.home$Date=as.numeric(as.POSIXct(datas.home$Date))*1000\n      \n      datas.home.melt=melt(datas.home,value.name = 'value',id.vars = c('Date'))\n      \n      # Graphiques\n      h_buts <- rCharts::hPlot(data = datas.home.melt,\n                               x=\"Date\",y=\"value\",group=\"variable\",\n                               type=\"column\",\n                               title =paste(\"Nbre de buts par match a l exterieur: \",input$away_team,sep=\"\"))\n      \n      h_buts$xAxis(type = \"datetime\")\n      h_buts$chart(height=450,zoomType = \"xy\",width=600)\n      h_buts$exporting(enabled = T)\n      h_buts$params$yAxis[1]=list(list(title = list(text = 'Nbre de buts par match a l exterieur')))\n      h_buts$colors('#99CC99', '#f4b541', '#4587DE')\n      #   green, yellow, blue\n      \n      # Moyenne mobile\n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$total_goals,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals total\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#4587DE\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n      )\n      \n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_first_half,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals first half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#99CC99\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_second_half,input$moy_mob)), json = F, names = F),\n        name =  paste(\"Mean goals second half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#f4b541\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,2.5), json = F, names = F),\n        type = \"spline\",\n        color=\"black\",\n        enableMouseTracking=F,\n        marker=list(enabled=F),\n        lineWidth=2\n        #yAxis=1\n      )\n      \n      h_buts\n      \n    }\n    \n  })\n  \n  #### Graphique nombres de buts a domicile\n  output$graph_but_home <- renderChart2({  \n\n    h_buts <- Highcharts$new()\n    \n    if(length(team)>0)\n    {\n      #selction de l equipe\n      i=which(input$home_team==team)\n      datas.home <- dplyr::filter(datas_bet,HomeTeam==team[i])\n      \n      ##### Nombre de buts      \n      #transfo dates pour hplot\n      datas.home=data.frame(Date=datas.home$Date,\n                            total_goals=datas.home$FTHG,\n                            goals_first_half=datas.home$HTHG,\n                            goals_second_half=datas.home$FTHG-datas.home$HTHG\n                            )\n      \n      datas.home$Date=as.numeric(as.POSIXct(datas.home$Date))*1000\n      \n      datas.home.melt=melt(datas.home,value.name = 'value',id.vars = c('Date'))\n      \n      # Graphiques\n      h_buts <- rCharts::hPlot(data = datas.home.melt,\n                                x=\"Date\",y=\"value\",group=\"variable\",\n                                type=\"column\",\n                                title =paste(\"Nbre de buts marques a domicile: \",input$home_team,sep=\"\"))\n      \n      h_buts$xAxis(type = \"datetime\")\n      h_buts$chart(height=450,zoomType = \"xy\",width=600)\n      h_buts$exporting(enabled = T)\n      h_buts$params$yAxis[1]=list(list(title = list(text = 'Nbre de buts marques a domicile')))\n      h_buts$colors('#99CC99', '#f4b541', '#4587DE')\n      #   green, yellow, blue\n      \n      # Moyenne mobile\n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$total_goals,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals total\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#4587DE\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n      )\n      \n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_first_half,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals first half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#99CC99\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_second_half,input$moy_mob)), json = F, names = F),\n        name =  paste(\"Mean goals second half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#f4b541\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n#       h_buts$series(\n#         data = toJSONArray2(data.frame(datas.home$Date,2.5), json = F, names = F),\n#         type = \"spline\",\n#         color=\"black\",\n#         enableMouseTracking=F,\n#         marker=list(enabled=F),\n#         lineWidth=2\n#         #yAxis=1\n#       )\n      \n      h_buts\n      \n    }\n \n  })\n  \n  #### Graphique nombres de buts a l exterieur\n  output$graph_but_away <- renderChart2({    \n    \n    h_buts_away <- Highcharts$new()\n    \n    if(length(team)>0)\n    {\n      #selction de l equipe\n      i=which(input$away_team==team)\n      datas.away <- dplyr::filter(datas_bet,AwayTeam==team[i])\n      \n      ##### Nombre de buts      \n      #transfo dates pour hplot\n      datas.away=data.frame(Date=datas.away$Date,\n                            total_goals=datas.away$FTAG,\n                            goals_first_half=datas.away$HTAG,\n                            goals_second_half=datas.away$FTAG-datas.away$HTAG\n      )\n      \n      datas.away$Date=as.numeric(as.POSIXct(datas.away$Date))*1000\n      \n      datas.away.melt=melt(datas.away,value.name = 'value',id.vars = c('Date'))\n      \n      # Graphiques\n      h_buts_away <- rCharts::hPlot(data = datas.away.melt,\n                               x=\"Date\",y=\"value\",group=\"variable\",\n                               type=\"column\",\n                               title =paste(\"Nbre de buts marque a l exterieur : \",input$away_team,sep=\"\"))\n      \n      h_buts_away$xAxis(type = \"datetime\")\n      h_buts_away$chart(height=450,zoomType = \"xy\",width=600)\n      h_buts_away$exporting(enabled = T)\n      h_buts_away$params$yAxis[1]=list(list(title = list(text = 'Nbre de buts')))\n      h_buts_away$colors('#99CC99', '#f4b541', '#4587DE')\n      \n      # Moyenne mobile\n      h_buts_away$series(\n        data = toJSONArray2(data.frame(datas.away$Date,runmean(datas.away$total_goals,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals total\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#4587DE\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n      )\n      \n      h_buts_away$series(\n        data = toJSONArray2(data.frame(datas.away$Date,runmean(datas.away$goals_first_half,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals first half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#99CC99\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_buts_away$series(\n        data = toJSONArray2(data.frame(datas.away$Date,runmean(datas.away$goals_second_half,input$moy_mob)), json = F, names = F),\n        name =  paste(\"Mean goals second half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#f4b541\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_buts_away\n      \n    }\n  })\n  \n  #nombre de buts encaise a domicile\n  output$graph_but_home_encaisse <- renderChart2({  \n    \n    h_buts <- Highcharts$new()\n    \n    if(length(team)>0)\n    {\n      #selction de l equipe\n      i=which(input$home_team==team)\n      datas.home <- dplyr::filter(datas_bet,HomeTeam==team[i])\n      \n      ##### Nombre de buts      \n      #transfo dates pour hplot\n      datas.home=data.frame(Date=datas.home$Date,\n                            total_goals=datas.home$FTAG,\n                            goals_first_half=datas.home$HTAG,\n                            goals_second_half=datas.home$FTAG-datas.home$HTAG\n      )\n      \n      datas.home$Date=as.numeric(as.POSIXct(datas.home$Date))*1000\n      \n      datas.home.melt=melt(datas.home,value.name = 'value',id.vars = c('Date'))\n      \n      # Graphiques\n      h_buts <- rCharts::hPlot(data = datas.home.melt,\n                               x=\"Date\",y=\"value\",group=\"variable\",\n                               type=\"column\",\n                               title =paste(\"Nbre de buts encaisse a domicile : \",input$home_team,sep=\"\"))\n      \n      h_buts$xAxis(type = \"datetime\")\n      h_buts$chart(height=450,zoomType = \"xy\",width=600)\n      h_buts$exporting(enabled = T)\n      h_buts$params$yAxis[1]=list(list(title = list(text = 'Nbre de buts')))\n      h_buts$colors('#99CC99', '#f4b541', '#4587DE')\n      #   green, yellow, blue\n      \n      # Moyenne mobile\n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$total_goals,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals total\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#4587DE\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n      )\n      \n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_first_half,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals first half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#99CC99\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_second_half,input$moy_mob)), json = F, names = F),\n        name =  paste(\"Mean goals second half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#f4b541\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_buts\n      \n    }\n    \n  })\n  \n  \n  #nombre de buts encaise a l exterieur\n  output$graph_but_away_encaisse <- renderChart2({  \n    \n    h_buts <- Highcharts$new()\n    \n    if(length(team)>0)\n    {\n      #selction de l equipe\n      i=which(input$away_team==team)\n      datas.home <- dplyr::filter(datas_bet,AwayTeam==team[i])\n      \n      ##### Nombre de buts      \n      #transfo dates pour hplot\n      datas.home=data.frame(Date=datas.home$Date,\n                            total_goals=datas.home$FTHG,\n                            goals_first_half=datas.home$HTHG,\n                            goals_second_half=datas.home$FTHG-datas.home$HTHG\n      )\n      \n      datas.home$Date=as.numeric(as.POSIXct(datas.home$Date))*1000\n      \n      datas.home.melt=melt(datas.home,value.name = 'value',id.vars = c('Date'))\n      \n      # Graphiques\n      h_buts <- rCharts::hPlot(data = datas.home.melt,\n                               x=\"Date\",y=\"value\",group=\"variable\",\n                               type=\"column\",\n                               title =paste(\"Nbre de buts encaisses a l'exterieur : \",input$away_team,sep=\"\"))\n      \n      h_buts$xAxis(type = \"datetime\")\n      h_buts$chart(height=450,zoomType = \"xy\",width=600)\n      h_buts$exporting(enabled = T)\n      h_buts$params$yAxis[1]=list(list(title = list(text = 'Nbre de buts')))\n      h_buts$colors('#99CC99', '#f4b541', '#4587DE')\n      #   green, yellow, blue\n      \n      # Moyenne mobile\n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$total_goals,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals total\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#4587DE\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n      )\n      \n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_first_half,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean goals first half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#99CC99\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_buts$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_second_half,input$moy_mob)), json = F, names = F),\n        name =  paste(\"Mean goals second half\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#f4b541\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_buts\n      \n    }\n    \n  })\n  \n  \n  #### Graphique nombres de tirs on target a domicile\n  output$graph_shoots_home_target <- renderChart2({    \n    \n    h_shoots <- Highcharts$new()\n    \n    if(length(team)>0)\n    {\n      #selction de l equipe\n      i=which(input$home_team==team)\n      datas.home <- dplyr::filter(datas_bet,HomeTeam==team[i])\n      \n      ##### Nombre de buts      \n      #transfo dates pour hplot\n      datas.home=data.frame(Date=datas.home$Date,                          \n                            shoots_on_target=datas.home$HST,              \n                            shoots_on_target_conceed=datas.home$AST\n      )\n      \n      datas.home$Date=as.numeric(as.POSIXct(datas.home$Date))*1000\n      \n      datas.home.melt=melt(datas.home,value.name = 'value',id.vars = c('Date'))\n      \n      # Graphiques\n      h_shoots <- rCharts::hPlot(data = datas.home.melt,\n                               x=\"Date\",y=\"value\",group=\"variable\",\n                               type=\"column\",\n                               title =paste(\"Nbre shoots on target : \",input$home_team,sep=\"\"))\n      \n      h_shoots$xAxis(type = \"datetime\")\n      h_shoots$chart(height=450,zoomType = \"xy\",width=600)\n      h_shoots$exporting(enabled = T)\n      h_shoots$params$yAxis[1]=list(list(title = list(text = 'Nbre de tirs')))\n      h_shoots$colors('#99CC99', '#f4b541', '#4587DE','#FB9058')\n      #   green, yellow, blue, orange\n      \n \n      h_shoots$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$shoots_on_target,input$moy_mob)), json = F, names = F),\n        name =  paste(\"Mean shoots on target\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#99CC99\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      \n      h_shoots$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$shoots_on_target_conceed,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean shoots conceed on target\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#f4b541\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_shoots\n      \n    }\n  })\n  \n  output$graph_shoots_home <- renderChart2({    \n    \n    h_shoots <- Highcharts$new()\n    \n    if(length(team)>0)\n    {\n      #selction de l equipe\n      i=which(input$home_team==team)\n      datas.home <- dplyr::filter(datas_bet,HomeTeam==team[i])\n      \n      ##### Nombre de buts      \n      #transfo dates pour hplot\n      datas.home=data.frame(Date=datas.home$Date,                          \n                            shoots=datas.home$HS,              \n                            shoots_conceed=datas.home$AS\n      )\n      \n      datas.home$Date=as.numeric(as.POSIXct(datas.home$Date))*1000\n      \n      datas.home.melt=melt(datas.home,value.name = 'value',id.vars = c('Date'))\n      \n      # Graphiques\n      h_shoots <- rCharts::hPlot(data = datas.home.melt,\n                                 x=\"Date\",y=\"value\",group=\"variable\",\n                                 type=\"column\",\n                                 title =paste(\"Nbre shoots : \",input$home_team,sep=\"\"))\n      \n      h_shoots$xAxis(type = \"datetime\")\n      h_shoots$chart(height=450,zoomType = \"xy\",width=600)\n      h_shoots$exporting(enabled = T)\n      h_shoots$params$yAxis[1]=list(list(title = list(text = 'Nbre shoots')))\n      h_shoots$colors('#99CC99', '#f4b541', '#4587DE','#FB9058')\n      #   green, yellow, blue, orange\n      \n      \n      h_shoots$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$shoots,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean shoots\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#99CC99\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      \n      h_shoots$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$shoots_conceed,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean shoots conceed\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#f4b541\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      h_shoots\n      \n    }\n  })\n  \n  #### Graphique nombres tirs away \n  output$graph_shoots_away <- renderChart2({    \n    \n    h_shoots_away <- Highcharts$new()\n    \n    if(length(team)>0)\n    {\n      #selction de l equipe\n      i=which(input$away_team==team)\n      datas.home <- dplyr::filter(datas_bet,AwayTeam==team[i])\n      \n      ##### Nombre de buts      \n      #transfo dates pour hplot\n      datas.home=data.frame(Date=datas.home$Date,\n                            shoots=datas.home$HS,\n                            shoots_conceed=datas.home$AS\n      )\n      datas.shoot.away <<- datas.home\n      datas.home$Date=as.numeric(as.POSIXct(datas.home$Date))*1000\n      \n      datas.home.melt=melt(datas.home,value.name = 'value',id.vars = c('Date'))\n      \n      # Graphiques\n      h_shoots_away <- rCharts::hPlot(data = datas.home.melt,\n                                 x=\"Date\",y=\"value\",group=\"variable\",\n                                 type=\"column\",\n                                 title =paste(\"Nbre shoots : \",input$away_team,sep=\"\"))\n      \n      h_shoots_away$xAxis(type = \"datetime\")\n      h_shoots_away$chart(height=450,zoomType = \"xy\",width=600)\n      h_shoots_away$exporting(enabled = T)\n      h_shoots_away$params$yAxis[1]=list(list(title = list(text = 'Nbre de tirs')))\n      h_shoots_away$colors('#99CC99', '#f4b541', '#4587DE','#FB9058')\n      #   green, yellow, blue, orange\n      \n      # Moyenne mobile\n      h_shoots_away$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$shoots,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean shoots\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#99CC99\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n      )\n      \n\n      h_shoots_away$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$shoots_conceed,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean shoots conceed\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#f4b541\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      \n      h_shoots_away\n      \n    }\n  })\n  \n  #### Graphique nombres de tirs on target a l exterieur\n  output$graph_shoots_away_target <- renderChart2({    \n    \n    h_shoots_away <- Highcharts$new()\n    \n    if(length(team)>0)\n    {\n      #selction de l equipe\n      i=which(input$away_team==team)\n      datas.home <- dplyr::filter(datas_bet,AwayTeam==team[i])\n      \n      ##### Nombre de buts      \n      #transfo dates pour hplot\n      datas.home=data.frame(Date=datas.home$Date,\n                            shoots_on_target=datas.home$HST,\n                            shoots_on_target_conceed=datas.home$AST\n      )\n      datas.shoot.away <<- datas.home\n      datas.home$Date=as.numeric(as.POSIXct(datas.home$Date))*1000\n      \n      datas.home.melt=melt(datas.home,value.name = 'value',id.vars = c('Date'))\n      \n      # Graphiques\n      h_shoots_away <- rCharts::hPlot(data = datas.home.melt,\n                                      x=\"Date\",y=\"value\",group=\"variable\",\n                                      type=\"column\",\n                                      title =paste(\"Nbre shoots on target : \",input$away_team,sep=\"\"))\n      \n      h_shoots_away$xAxis(type = \"datetime\")\n      h_shoots_away$chart(height=450,zoomType = \"xy\",width=600)\n      h_shoots_away$exporting(enabled = T)\n      h_shoots_away$params$yAxis[1]=list(list(title = list(text = 'Nbre de tirs')))\n      h_shoots_away$colors('#99CC99', '#f4b541', '#4587DE','#FB9058')\n      #   green, yellow, blue, orange\n      \n      # Moyenne mobile\n      \n      h_shoots_away$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$shoots_on_target,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean shoots on target\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#99CC99\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n\n      h_shoots_away$series(\n        data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$shoots_on_target_conceed,input$moy_mob)), json = F, names = F),\n        name = paste(\"Mean shoots conceed on target\",input$moy_mob,\"days\"),\n        type = \"spline\",\n        color=\"#f4b541\",\n        enableMouseTracking=T,\n        marker=list(enabled=F),\n        lineWidth=1.5\n        #yAxis=1\n      )\n      \n      \n      h_shoots_away\n      \n    }\n  })\n  \n#### Graphique nombres de buts a domicile et a l'exterieur\noutput$graph_buts_match_home <- renderChart2({  \n  \n  h_buts <- Highcharts$new()\n  \n  if(length(team)>0)\n  {\n    #selction de l equipe\n    i=which(input$home_team==team)\n    datas.home <- dplyr::filter(datas_bet,HomeTeam==team[i] | AwayTeam==team[i])\n    \n    ##### Nombre de buts      \n    #transfo dates pour hplot\n    datas.home=data.frame(Date=datas.home$Date,\n                          total_goals=datas.home$FTHG+datas.home$FTAG ,\n                          goals_first_half=datas.home$HTHG+datas.home$HTAG,\n                          goals_second_half=(datas.home$FTHG+datas.home$FTAG)-(datas.home$HTHG+datas.home$HTAG)\n    )\n    \n    datas.home$Date=as.numeric(as.POSIXct(datas.home$Date))*1000\n    \n    datas.home.melt=melt(datas.home,value.name = 'value',id.vars = c('Date'))\n    \n    # Graphiques\n    h_buts <- rCharts::hPlot(data = datas.home.melt,\n                             x=\"Date\",y=\"value\",group=\"variable\",\n                             type=\"column\",\n                             title =paste(\"Nbre de buts par matchs a domicile et a l'exterieur: \",input$home_team,sep=\"\"))\n    \n    h_buts$xAxis(type = \"datetime\")\n    h_buts$chart(height=450,zoomType = \"xy\",width=600)\n    h_buts$exporting(enabled = T)\n    h_buts$params$yAxis[1]=list(list(title = list(text = 'Nbre de buts par matchs a domicile et a l exterieur')))\n    h_buts$colors('#99CC99', '#f4b541', '#4587DE')\n    #   green, yellow, blue\n    \n    # Moyenne mobile\n    h_buts$series(\n      data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$total_goals,input$moy_mob)), json = F, names = F),\n      name = paste(\"Mean goals total\",input$moy_mob,\"days\"),\n      type = \"spline\",\n      color=\"#4587DE\",\n      enableMouseTracking=T,\n      marker=list(enabled=F),\n      lineWidth=1.5\n    )\n    \n    h_buts$series(\n      data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_first_half,input$moy_mob)), json = F, names = F),\n      name = paste(\"Mean goals first half\",input$moy_mob,\"days\"),\n      type = \"spline\",\n      color=\"#99CC99\",\n      enableMouseTracking=T,\n      marker=list(enabled=F),\n      lineWidth=1.5\n      #yAxis=1\n    )\n    \n    h_buts$series(\n      data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_second_half,input$moy_mob)), json = F, names = F),\n      name =  paste(\"Mean goals second half\",input$moy_mob,\"days\"),\n      type = \"spline\",\n      color=\"#f4b541\",\n      enableMouseTracking=T,\n      marker=list(enabled=F),\n      lineWidth=1.5\n      #yAxis=1\n    )\n    \n    h_buts$series(\n      data = toJSONArray2(data.frame(datas.home$Date,2.5), json = F, names = F),\n      type = \"spline\",\n      color=\"black\",\n      enableMouseTracking=F,\n      marker=list(enabled=F),\n      lineWidth=2\n      #yAxis=1\n    )\n    \n    h_buts\n    \n  }\n  \n})\n\n#### Graphique nombres de buts a domicile et a l'exterieur\noutput$graph_buts_match_away <- renderChart2({  \n  \n  h_buts <- Highcharts$new()\n  \n  if(length(team)>0)\n  {\n    #selction de l equipe\n    i=which(input$away_team==team)\n    datas.home <- dplyr::filter(datas_bet,HomeTeam==team[i] | AwayTeam==team[i])\n    \n    ##### Nombre de buts      \n    #transfo dates pour hplot\n    datas.home=data.frame(Date=datas.home$Date,\n                          total_goals=datas.home$FTHG+datas.home$FTAG ,\n                          goals_first_half=datas.home$HTHG+datas.home$HTAG,\n                          goals_second_half=(datas.home$FTHG+datas.home$FTAG)-(datas.home$HTHG+datas.home$HTAG)\n    )\n    \n    datas.home$Date=as.numeric(as.POSIXct(datas.home$Date))*1000\n    \n    datas.home.melt=melt(datas.home,value.name = 'value',id.vars = c('Date'))\n    \n    # Graphiques\n    h_buts <- rCharts::hPlot(data = datas.home.melt,\n                             x=\"Date\",y=\"value\",group=\"variable\",\n                             type=\"column\",\n                             title =paste(\"Nbre de buts par matchs a domicile et a l'exterieur: \",input$away_team,sep=\"\"))\n    \n    h_buts$xAxis(type = \"datetime\")\n    h_buts$chart(height=450,zoomType = \"xy\",width=600)\n    h_buts$exporting(enabled = T)\n    h_buts$params$yAxis[1]=list(list(title = list(text = 'Nbre de buts par matchs a domicile et a l exterieur')))\n                                                  h_buts$colors('#99CC99', '#f4b541', '#4587DE')\n                                                  #   green, yellow, blue\n                                                  \n                                                  # Moyenne mobile\n                                                  h_buts$series(\n                                                    data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$total_goals,input$moy_mob)), json = F, names = F),\n                                                    name = paste(\"Mean goals total\",input$moy_mob,\"days\"),\n                                                    type = \"spline\",\n                                                    color=\"#4587DE\",\n                                                    enableMouseTracking=T,\n                                                    marker=list(enabled=F),\n                                                    lineWidth=1.5\n                                                  )\n                                                  \n                                                  h_buts$series(\n                                                    data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_first_half,input$moy_mob)), json = F, names = F),\n                                                    name = paste(\"Mean goals first half\",input$moy_mob,\"days\"),\n                                                    type = \"spline\",\n                                                    color=\"#99CC99\",\n                                                    enableMouseTracking=T,\n                                                    marker=list(enabled=F),\n                                                    lineWidth=1.5\n                                                    #yAxis=1\n                                                  )\n                                                  \n                                                  h_buts$series(\n                                                    data = toJSONArray2(data.frame(datas.home$Date,runmean(datas.home$goals_second_half,input$moy_mob)), json = F, names = F),\n                                                    name =  paste(\"Mean goals second half\",input$moy_mob,\"days\"),\n                                                    type = \"spline\",\n                                                    color=\"#f4b541\",\n                                                    enableMouseTracking=T,\n                                                    marker=list(enabled=F),\n                                                    lineWidth=1.5\n                                                    #yAxis=1\n                                                  )\n                                                  \n                                                  h_buts$series(\n                                                    data = toJSONArray2(data.frame(datas.home$Date,2.5), json = F, names = F),\n                                                    type = \"spline\",\n                                                    color=\"black\",\n                                                    enableMouseTracking=F,\n                                                    marker=list(enabled=F),\n                                                    lineWidth=2\n                                                    #yAxis=1\n                                                  )\n                                                  \n                                                  h_buts\n                                                  \n  }\n  \n})\n\n  output$dt_shoots_away <- DT::renderDataTable({\n   \n      datas.shoot.away\n    \n  }, options = list(paging = FALSE,lengthChange = FALSE,bFilter=FALSE))\n\n  \n}) # end shiny server\n\n\n\n\n",
    "created" : 1443248671558.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "85061281",
    "id" : "2B161705",
    "lastKnownWriteTime" : 1443442238,
    "path" : "~/04_Boulot/03_Prog/01_Previ/betting/SupaBet/server.R",
    "project_path" : "server.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}